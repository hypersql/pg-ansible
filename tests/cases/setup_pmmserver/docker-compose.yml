version: "1"

services:
  ansible-tester:
    build:
      context: ../../docker
      dockerfile: Dockerfile.ansible-tester
    environment:
      - OPENSQL_PG_TYPE
      - OPENSQL_PG_VERSION
      - OPENSQL_OS_TYPE
      - CASE_NAME
    volumes:
      - ../..:/workspace
    command: "/workspace/docker/exec-tests.sh"

  pmmserver1-debian10:
    privileged: true
    build:
      context: ../../docker
      dockerfile: Dockerfile.debian10
    cap_add:
      - SYS_ADMIN
    volumes:
      - .:/workspace
      - /sys/fs/cgroup/:/sys/fs/cgroup:ro
      - /var/run/docker.sock:/var/run/docker.sock

  pmmserver1-ubuntu20:
    privileged: true
    build:
      context: ../../docker
      dockerfile: Dockerfile.ubuntu20
    cap_add:
      - SYS_ADMIN
    volumes:
      - .:/workspace
      - /sys/fs/cgroup/:/sys/fs/cgroup:ro
      - /var/run/docker.sock:/var/run/docker.sock
    tmpfs:
      - /run
      - /tmp
      - /run/sshd
      - /run/lock

  pmmserver1-centos7:
    privileged: true
    build:
      context: ../../docker
      dockerfile: Dockerfile.centos7
    cap_add:
      - SYS_ADMIN
    volumes:
      - .:/workspace
      - /sys/fs/cgroup/:/sys/fs/cgroup:ro
      - /var/run/docker.sock:/var/run/docker.sock
    command: /usr/sbin/init